<div class="row">
    <div class="col s12">
        <h5 class="center-align"><strong>Your rating and reviews</strong></h5>
    </div>
    <!-- RENDER RECORED RATINGS (if it exists) -->  
    <% if (allUserRating) { %>
        <!-- Overall ratings -->
        <div class="col s12">
            <div class="card-panel yellow lighten-5">
                <div class="row">
                    <% 
                    const initVal = 0;
                    let totalStar = 0;
                    let countStar = [0, 0, 0, 0, 0];
                    allUserRating.forEach(function (rating) {
                        let rt = parseInt(rating.rating);
                        totalStar += rt;
                        countStar[rt-1] += 1;
                    })
                    totalStar = totalStar/allUserRating.length;
                    let allPercentStar = [0, 0, 0, 0, 0];
                    countStar.forEach(function (count, index) {
                        allPercentStar[index] = Math.round((count/allUserRating.length)*100);
                        
                    })
                    %>
                    
                    <h5 class="center-align" style="padding-bottom: 1rem;"><strong>Overall Ratings</strong></h5>
                    <div data-cy="overall-rating-section" class="col s12 m4 l3 center-align">
                        <h4><%= totalStar %></h4>
                        <% 
                        rate1 = Math.floor(totalStar);
                        rate2 = totalStar - rate1;
                        for (let i=0; i<rate1; i++) { %>
                            <i class="material-icons Small orange-text">star</i>
                        <% } 
                        if (rate2 > 0.75) { %>
                            <i class="material-icons Small orange-text">star</i>
                        <% } else if (rate2 > 0.25) { %>
                            <i class="material-icons Small orange-text">star_half</i>
                        <% } else if ((rate2 > 0) && (rate1 < 5)) { %>
                            <i class="material-icons Small orange-text">star_border</i>
                        <% } 
                        for (let i=0; i<5-rate1-1; i++) { %>
                            <i class="material-icons Small orange-text">star_border</i>
                        <% } %>
                        
                        <br>
                        <span><%= allUserRating.length %> Reviews</span>
                    </div>
                    
                    <div data-cy="received-rating-section" class="col s12 m8 l9">
                        <% for (let i=allPercentStar.length-1; i>=0; i--) {  
                            percentStar = allPercentStar[i]; %>
                            <div class="valign-wrapper">
                                <span style="padding-right: 2px;"><%= i+1 %></span>
                                <i class="material-icons Small orange-text" style="padding-right: 1rem;">star</i>
                                <div class="progress">
                                    <div class="determinate" style="width: <%= percentStar %>%"></div>
                                </div>
                                <span style="padding-left: 1rem;">(<%= countStar[i] %>)</span>
                            </div>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>

        <!-- All reviews -->
        <% allUserRating.forEach(function (rating) { %>
            <div class="col s12 m6"> 
                <div class="yellow lighten-5 z-depth-1" style="border: 1px solid rgb(248, 197, 69); border-radius: 1rem; margin-top: 1%; margin-bottom: 1%;">
                    <div class="valign-wrapper" style="padding-left: 2%; padding-right: 2%; padding-top: 2%;">
                        <i class="large material-icons">account_circle</i>
                        <div>
                            <h6><strong><%= rating.rater_id %></strong></h6>
                            <span>
                                <% for (let i=0; i<5; i++) { 
                                    if ( i < rating.rating ) { %>
                                        <i class="material-icons Small orange-text">star</i>
                                    <% } else { %>
                                        <i class="material-icons Small orange-text">star_border</i>
                                    <% } 
                                } %>
                            </span>
                            <br>
                            <span><small><%= rating.date %> - <%= rating.time %></small></span>
                        </div>
                        
                    </div>
                    <div class="divider" style="margin: 3%;"></div>
                    <div style="padding-left: 3%; padding-right: 3%;">
                        <p><%= rating.review %></p>
                        
                    </div>
                    <div style="padding-left: 3%; padding-right: 3%;">
                        <p class="yellow lighten-4" style="padding: 3%;">
                            <span>Project: <%= rating.project_duration %> day(s) ago</span>
                            <span class="new badge green" data-badge-caption="<%= rating.project_status %>"></span>
                        </p>
                    </div>
                    
                </div>
                
            </div>
        <% }) %>
    <% } else { %>
        <div class="col s12">
            <h6 class="center-align">You haven't got any ratings and reviews yet.</h6>
        </div>
    <% } %>
</div>